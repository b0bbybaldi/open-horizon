<!DOCTYPE html>
<html>
<head>
<link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans" rel="stylesheet">
<style> body { font-family: 'IBM+Plex+Sans', sans-serif, serif; } </style>
<title>Horizon Control</title>
</head>

<script>
var nodes = new XMLHttpRequest();
nodes.onreadystatechange = function() {
  if (this.readyState == 4 && this.status == 200 && this.responseText != null) {
    var jobj = JSON.parse(this.responseText);
    nodeoutput.innerHTML += '<hr>';
    if (jobj != null) {
      if (jobj["nodes"] != null) {
        str = '<table><tr><th>Service</th><th>Last Heartbeat</th></tr>';
        jobj["nodes"].forEach(function(item,index) {
          str += '<tr><td>' + item.id + '</td><td>' + item.lastHeartbeat + '</td></tr>';
        });
        str += '</table>';
        nodeoutput.innerHTML += str;
      }
    }
    nodeoutput.innerHTML += '<hr>';
  }
}
nodes.open("GET","/cgi-bin/nodes", true);
nodes.send();
</script>

<script>
var services = new XMLHttpRequest();
services.onreadystatechange = function() {
  if (this.readyState == 4 && this.status == 200 && this.responseText != null) {
    var jobj = JSON.parse(this.responseText);
    serviceoutput.innerHTML += '<hr>';
    if (jobj != null) {
      if (jobj["services"] != null) {
        str = '<table><tr><th>Service</th><th>Last Updated</th></tr>';
        jobj["services"].forEach(function(item,index) {
          str += '<tr><td>' + item.id + '</td><td>' + item.lastUpdated + '</td></tr>';
        });
        str += '</table>';
        serviceoutput.innerHTML += str;
      }
    }
    serviceoutput.innerHTML += '<hr>';
  }
}
services.open("GET","/cgi-bin/services", true);
services.send();
</script>

<script>
var patterns = new XMLHttpRequest();
patterns.onreadystatechange = function() {
  if (this.readyState == 4 && this.status == 200 && this.responseText != null) {
    var jobj = JSON.parse(this.responseText);
    patternoutput.innerHTML += '<hr>';
    if (jobj != null) {
      if (jobj["patterns"] != null) {
        str = '<table><tr><th>Pattern</th><th>Last Updated</th></tr>';
        jobj["patterns"].forEach(function(item,index) {
          str += '<tr><td>' + item.id + '</td><td>' + item.lastUpdated + '</td></tr>';
        });
        str += '</table>';
        patternoutput.innerHTML += str;
      }
    }
    patternoutput.innerHTML += '<hr>';
  }
}
patterns.open("GET","/cgi-bin/patterns", true);
patterns.send();
</script>

<script>
var exchange = new XMLHttpRequest();
exchange.onreadystatechange = function() {
  if (this.readyState == 4 && this.exchange == 200 && this.responseText != null) {
    var jobj = JSON.parse(this.responseText);
    if (jobj != null) {
      exchangeoutput.innerHTML += '<hr>Exchange Found<hr>';
      // str += '<hr>';
      // str += 'Message:' + jobj.msg + '<br>';
      // str += 'Number of users:' + jobj.numberOfUsers + '<br>';
      // str += 'Number of nodes:' + jobj.numberOfNodes + '<br>';
      // str += 'Number of node agreements:' + jobj.numberOfNodeAgreements + '<br>';
      // str += 'Number of node messages:' + jobj.numberOfNodeMsgs + '<br>';
      // str += 'Number of agbot agreements:' + jobj.numberOfAgbotAgreements + '<br>';
      // str += 'Number of agbot messages:' + jobj.numberOfAgbotMsgs + '<br>';
      // str += 'DB schema verison:' + jobj.dbSchemaVersion + '<br>';
      // str += '<hr>';
      // exchangeoutput.innerHTML += str;
    } else {
      exchangeoutput.innerHTML += '<hr>No Exchange<hr>';
    }
  }
}
exchange.open("GET","/cgi-bin/exchange", true);
exchange.send();
</script>

<body>
<h1>Horizon Monitor</h1>
<h2>Exchange</h2><div id="exchangeoutput"></div>
<h2>Patterns</h2><div id="patternoutput"></div>
<h2>Nodes</h2><div id="nodeoutput"></div>
<h2>Services</h2><div id="serviceoutput"></div>
</body>
</html>
